<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WorkMate Pet</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #F5F5DC;
      color: #333;
      text-align: center;
      overflow: hidden; 
      user-select: none; 
      -webkit-app-region: drag; 
    }

    /* ë©”ë‰´ë°” */
    .titlebar {
      height: 30px;
      background: #8B4513;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 10px;
      -webkit-app-region: drag;
    }

    .titlebar-title {
      font-size: 12px;
      font-weight: bold;
      color: #F5F5DC; 
    }

    .titlebar-buttons {
      display: flex;
      gap: 5px;
      -webkit-app-region: no-drag; 
    }

    .titlebar-button {
      width: 20px;
      height: 20px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .minimize-btn {
      background: #F5F5DC;
      color: #8B4513;
    }

    .minimize-btn:hover {
      background: #E6E6D4;
    }

    .close-btn {
      background: #F5F5DC;
      color: #8B4513;
    }

    .close-btn:hover {
      background: #E6E6D4;
    }
    .content {
      padding: 5px;
      -webkit-app-region: no-drag;
    }

    .timer {
      font-size: 48px;
      font-weight: bold;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      color: #333;
    }

    .pet-container {
      width: 200px;
      height: 200px;
      margin: 10px auto;
      background: rgba(139, 69, 19, 0.1);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s;
      position: relative;
      overflow: hidden;
    }

    .pet-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* ë¶ˆê½ƒ ì´í™íŠ¸ */
    .pet-container.fire-effect::before {
      content: 'ğŸ”¥';
      position: absolute;
      top: -20px;
      left: 50%;
    }

    @keyframes fireFlicker {
      0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
      50% { opacity: 0.7; transform: translateX(-50%) scale(1.1); }
    }

    .pet-container:hover {
      transform: scale(1.1);
    }

    .pet-container:active {
      transform: scale(0.95);
    }

    .exp-bar {
      width: 80%;
      height: 20px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      margin: 10px auto;
      overflow: hidden;
    }

    .exp-fill {
      height: 100%;
      background: #4CAF50;
      width: 0%;
      transition: width 0.3s;
    }

    /* ìƒíƒœ ê²Œì´ì§€ */
    .status-bars-container {
      width: 80%;
      margin: 10px auto;
      display: flex;
      gap: 5px;
      justify-content: space-between;
    }

    .status-bar-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .status-bar {
      width: 100%;
      height: 6.67px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3.33px;
      overflow: hidden;
      margin-bottom: 5px;
    }

    .status-bar-fill {
      height: 100%;
      background: #DC143C;
      width: 100%;
    }

    .status-bar-label {
      font-size: 11px;
      color: #666;
      margin-top: 2px;
    }

    .level {
      font-size: 18px;
      margin: 10px 0;
      color: #333;
    }

    .controls {
      margin-top: 20px;
    }

    button {
      background: #8B4513;
      color: #F5F5DC;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    button:hover {
      background: #A0522D;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    button:active {
      transform: translateY(0);
    }

    /* ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
    .notification {
      position: fixed;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: none;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .status {
  font-size: 14px;
  margin: 10px 0;
  padding: 5px 15px;
  background: rgba(139, 69, 19, 0.2);
  border-radius: 15px;
  display: inline-block;
  color: #333;
}

.status.active {
  background: rgba(139, 69, 19, 0.4);
  animation: pulse 1.5s infinite;
  color: #8B4513;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.selected-programs {
  margin-top: 15px;
  font-size: 12px;
  color: #666;
}

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  -webkit-app-region: no-drag;
}

.modal-content {
  background: white;
  color: #333;
  padding: 20px;
  border-radius: 10px;
  width: 320px;
  max-height: 500px;
  overflow-y: auto;
}

.modal-content h2 {
  margin-top: 0;
  font-size: 18px;
}

.program-list {
  max-height: 300px;
  overflow-y: auto;
  margin: 15px 0;
}

.program-item {
  display: flex;
  align-items: center;
  padding: 8px;
  margin: 5px 0;
  background: #f5f5f5;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.2s;
}

.program-item:hover {
  background: #e0e0e0;
}

.program-item input[type="checkbox"] {
  margin-right: 10px;
  cursor: pointer;
}

.modal-buttons {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 15px;
}

.modal-buttons button {
  padding: 8px 20px;
}

.program-item label {
  flex: 1;
  padding: 5px;
}

/* ìºë¦­í„° ê´€ë¦¬ í™”ë©´ */
.management-screen {
  display: none;
  padding: 0;
  position: relative;
}

.management-screen.active {
  display: block;
}

.back-button {
  position: absolute;
  top: 10px;
  left: 10px;
  background: #8B4513;
  color: #F5F5DC;
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
  z-index: 100;
}

.back-button:hover {
  background: #A0522D;
}

.pet-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  grid-template-rows: repeat(2, 1fr);
  gap: 10px;
  padding: 60px 20px 20px 20px;
  max-width: 500px;
  margin: 0 auto;
}

.pet-slot {
  aspect-ratio: 1;
  background: rgba(139, 69, 19, 0.2);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
  border: 2px solid transparent;
  overflow: hidden;
}

.pet-slot img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.pet-slot.active {
  background: rgba(139, 69, 19, 0.4);
  border-color: #8B4513;
  transform: scale(1.05);
}

.pet-slot.disabled {
  background: rgba(0, 0, 0, 0.2);
  opacity: 0.5;
  cursor: pointer;
}

.pet-slot:hover:not(.disabled) {
  background: rgba(139, 69, 19, 0.5);
  transform: scale(1.05);
}

/* í« ìƒì„¸ ì •ë³´ */
.pet-detail {
  margin-top: 30px;
  padding: 20px;
  background: rgba(139, 69, 19, 0.1);
  border-radius: 15px;
  text-align: center;
}

.pet-detail-emoji {
  font-size: 80px;
  margin-bottom: 15px;
  width: 120px;
  height: 120px;
  margin: 0 auto 15px auto;
  display: flex;
  align-items: center;
  justify-content: center;
}

.pet-detail-emoji img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.pet-detail-info {
  color: #333;
  font-size: 16px;
  line-height: 1.8;
}

.pet-detail-info strong {
  color: #8B4513;
}
  </style>
</head>
<body>
  <div class="titlebar">
    <div class="titlebar-title"> WorkMate Pet</div>
    <div class="titlebar-buttons">
      <button class="titlebar-button minimize-btn" onclick="minimizeWindow()">â”€</button>
      <button class="titlebar-button close-btn" onclick="closeWindow()">âœ•</button>
    </div>
  </div>

  <div class="content" id="mainContent">
    <div class="timer" id="timer">00:00:00</div>
    
    <div class="pet-container" id="pet" onclick="petClick()">
      <img id="petImage" src="../asset/img/cat-sleep.png" alt="Pet">
    </div>
    
    <div class="level" id="level">Level 1</div>
    
    <div class="exp-bar">
      <div class="exp-fill" id="expBar"></div>
    </div>
    
    <!-- ìƒíƒœ ê²Œì´ì§€ -->
    <div class="status-bars-container">
      <div class="status-bar-wrapper">
        <div class="status-bar">
          <div class="status-bar-fill"></div>
        </div>
        <div class="status-bar-label">Hygiene</div>
      </div>
      <div class="status-bar-wrapper">
        <div class="status-bar">
          <div class="status-bar-fill"></div>
        </div>
        <div class="status-bar-label">Hunger</div>
      </div>
      <div class="status-bar-wrapper">
        <div class="status-bar">
          <div class="status-bar-fill"></div>
        </div>
        <div class="status-bar-label">Happiness</div>
      </div>
    </div>
    
    <div class="status" id="status">Waiting...</div>
    
    <div class="selected-programs" id="selectedPrograms">No programs selected</div>
    
    <div class="controls">
      <button onclick="selectProgram()">Select Program</button>
      <button onclick="togglePetRoaming()" id="roamingBtn">Enable Roaming</button>
      <button onclick="openPetManagement()">My Pet</button>
    </div>
  </div>

  <!-- ìºë¦­í„° ê´€ë¦¬ í™”ë©´ -->
  <div class="content management-screen" id="managementScreen">
    <button class="back-button" onclick="closePetManagement()">â† Back</button>
    
    <!-- í« ì„ íƒ -->
    <div class="pet-grid" id="petGrid">

      <div class="pet-slot active" onclick="selectPet(0)">
        <img src="../asset/img/cat-icon.png" alt="Pet Icon" style="width: 100%; height: 100%; object-fit: contain;">
      </div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
      <div class="pet-slot disabled" onclick="showComingSoon()"></div>
    </div>
    
    <!-- í« ìƒì„¸ ì •ë³´ -->
    <div class="pet-detail" id="petDetail" style="display: none;">
      <div class="pet-detail-emoji" id="petDetailEmoji">
        <img src="../asset/img/cat-basic.png" alt="Pet" style="width: 100%; height: 100%; object-fit: contain;">
      </div>
      <div class="pet-detail-info">
        <div><strong>Level:</strong> <span id="petDetailLevel">1</span></div>
        <div><strong>Work Time:</strong> <span id="petDetailTime">00:00:00</span></div>
      </div>
    </div>
  </div>
  <div class="modal" id="programModal" style="display: none;">
    <div class="modal-content">
      <h2>Select Work Programs</h2>
      <div class="program-list" id="programList"></div>
      <div class="modal-buttons">
        <button onclick="closeProgramSelector()">Cancel</button>
        <button onclick="saveSelectedPrograms()">Save</button>
      </div>
    </div>
  </div>

  <div class="notification" id="notification"></div>


  <script>
  const { ipcRenderer } = require('electron');
  
  let seconds = 0;
  let isMonitoring = false;
  let exp = 0;
  let level = 1;
  let selectedPrograms = [];
  let availablePrograms = [];
  let currentActiveProgram = '';
  let isRoaming = false;
  let encouragementInterval = null;
  let continuousWorkTime = 0;
  let fireEffectInterval = null;
  let isCurrentlyActive = false;
  let currentPetState = 'sleep'; 
  let clickTimeout = null;
  let cheerTimeout = null;

  // í« ì´ë¯¸ì§€ ë³€ê²½
  function updatePetImage(state) {
    const petImage = document.getElementById('petImage');
    if (!petImage) return;
    if (currentPetState === 'cheer' && state !== 'cheer') {
      return;
    }
    
    if (state !== 'click' && state !== 'cheer') {
      currentPetState = state;
    } else if (state === 'cheer') {
      currentPetState = 'cheer';
    } else if (state === 'click') {
      currentPetState = 'click';
    }
    
    let imagePath = '../asset/img/cat-sleep.png';
    switch(state) {
      case 'sleep':
        imagePath = '../asset/img/cat-sleep.png';
        break;
      case 'basic':
        imagePath = '../asset/img/cat-basic.png';
        break;
      case 'burn':
        imagePath = '../asset/img/cat-burn.png';
        break;
      case 'cheer':
        imagePath = '../asset/img/cat-cheer.png';
        break;
      case 'click':
        imagePath = '../asset/img/cat-click.png';
        break;
    }
    
    petImage.src = imagePath;
  }

  // ì°½ ì œì–´
  function closeWindow() {
    ipcRenderer.send('window-close');
  }

  function minimizeWindow() {
    ipcRenderer.send('window-minimize');
  }

  // ì•Œë¦¼
  function showNotification(message) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style.display = 'block';
    setTimeout(() => {
      notification.style.display = 'none';
    }, 2000);
  }

  // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
  function updateTimer() {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    document.getElementById('timer').textContent = 
      `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    
    // í« ìƒì„¸ ì •ë³´ ì‹œê°„ë„ ì—…ë°ì´íŠ¸
    updatePetDetailTime();
  }

  // ê²½í—˜ì¹˜ ì—…ë°ì´íŠ¸
  function updateExp() {
    const expForLevel = level * 100;
    const progress = (exp % expForLevel) / expForLevel * 100;
    document.getElementById('expBar').style.width = progress + '%';
    
    if (exp >= expForLevel * level) {
      level++;
      document.getElementById('level').textContent = 'Level ' + level;
      showNotification('ğŸ‰ Level Up! Current Level: ' + level);
      
      // í« ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
      updatePetDetailTime();
    }
  }

  // ì €ì¥ëœ í”„ë¡œê·¸ë¨ ë¶ˆëŸ¬ì˜¤ê¸°
  ipcRenderer.on('load-selected-programs', (event, programs) => {
    selectedPrograms = programs;
    updateSelectedProgramsDisplay();
  });

  // ì„ íƒëœ í”„ë¡œê·¸ë¨ í‘œì‹œ ì—…ë°ì´íŠ¸
  function updateSelectedProgramsDisplay() {
    const el = document.getElementById('selectedPrograms');
    if (selectedPrograms.length === 0) {
      el.textContent = 'No programs selected';
    } else {
      el.textContent = 'Selected: ' + selectedPrograms.map(p => p.replace('.exe', '')).join(', ');
    }
  }

  // í”„ë¡œê·¸ë¨ ì„ íƒ
  function selectProgram() {
    openProgramSelector();
  }

  // ì‹œë©”ì§€ í™œì„±í™”/ë¹„í™œì„±í™”
  function togglePetRoaming() {
    isRoaming = !isRoaming;
    const btn = document.getElementById('roamingBtn');
    const petEmoji = document.getElementById('pet').textContent;
    
    if (isRoaming) {
      ipcRenderer.send('toggle-roaming', true, petEmoji);
      btn.textContent = 'Stop Roaming';
      showNotification('Roaming started!');
    } else {
      ipcRenderer.send('toggle-roaming', false);
      btn.textContent = 'Start Roaming';
      showNotification('Roaming stopped.');
    }
  }

  // ìºë¦­í„° ê´€ë¦¬ í™”ë©´
  function openPetManagement() {
    document.getElementById('mainContent').style.display = 'none';
    document.getElementById('managementScreen').classList.add('active');
    
    // ì²« ë²ˆì§¸ í«ì„ ê¸°ë³¸ìœ¼ë¡œ ì„ íƒ
    selectPet(0);
  }

  function closePetManagement() {
    document.getElementById('managementScreen').classList.remove('active');
    document.getElementById('mainContent').style.display = 'block';
  }

  // í« ì„ íƒ
  function selectPet(index) {
    const slots = document.querySelectorAll('.pet-slot');
    slots.forEach(slot => slot.classList.remove('active'));
    
    if (slots[index] && !slots[index].classList.contains('disabled')) {
      slots[index].classList.add('active');
      
      // í« ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
      updatePetDetail();
    }
  }
 // ë¹„í™œì„±í™” ìŠ¬ë¡¯ ë©”ì„¸ì§€
  function showComingSoon() {
    showNotification('Coming soon!');
  }

  // í« ìƒì„¸ ì •ë³´ ì‹œê°„
  function updatePetDetailTime() {
    const detailDiv = document.getElementById('petDetail');
    if (detailDiv && detailDiv.style.display !== 'none') {
      const timeEl = document.getElementById('petDetailTime');
      if (timeEl) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        timeEl.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      }
      
      const levelEl = document.getElementById('petDetailLevel');
      if (levelEl) {
        levelEl.textContent = level;
      }
    }
  }

  // í« ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
  function updatePetDetail() {
    const detailDiv = document.getElementById('petDetail');
    const emojiEl = document.getElementById('petDetailEmoji');
    const levelEl = document.getElementById('petDetailLevel');
    const timeEl = document.getElementById('petDetailTime');
    
    if (!emojiEl || !levelEl || !timeEl) return;
  
    emojiEl.innerHTML = '<img src="../asset/img/cat-basic.png" alt="Pet" style="width: 100%; height: 100%; object-fit: contain;">';
    
    // ë ˆë²¨ ì„¤ì •
    levelEl.textContent = level;
    
    // ì¼í•œ ì‹œê°„ ì„¤ì •
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    timeEl.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    
    // ìƒì„¸ ì •ë³´ í‘œì‹œ
    detailDiv.style.display = 'block';
  }

  // íƒ€ì´ë¨¸ í‹± ìˆ˜ì‹ 
  ipcRenderer.on('timer-tick', (event, isActive, programName) => {
    const statusEl = document.getElementById('status');
    const petContainer = document.getElementById('pet');
    currentActiveProgram = programName;
    isCurrentlyActive = isActive;
    
    if (isActive) {
      seconds++;
      exp++; // ê²½í—˜ì¹˜ ì¦ê°€
      continuousWorkTime++; // ì—°ì† ì‘ì—… ì‹œê°„ ì¦ê°€
      updateTimer();
      updateExp(); // ê²½í—˜ì¹˜ ê²Œì´ì§€ ì—…ë°ì´íŠ¸
      statusEl.textContent = `Working ğŸ”¥ (${programName})`;
      statusEl.classList.add('active');
      
      // 15ì´ˆ ì´ìƒ ì—°ì† ì‘ì—… ì‹œ ë¶ˆíƒ€ëŠ” ì´í™íŠ¸
      if (continuousWorkTime >= 15) {
        petContainer.classList.add('fire-effect');
        if (currentPetState !== 'cheer' && currentPetState !== 'click') {
          updatePetImage('burn');
        }
      } else {
        if (currentPetState !== 'cheer' && currentPetState !== 'click') {
          updatePetImage('basic');
        }
      }
      
      // ì‘ì› ë©”ì‹œì§€(10ì´ˆë§ˆë‹¤)
      if (!encouragementInterval) {
        encouragementInterval = setInterval(() => {
          if (isCurrentlyActive) {
            const messages = [
              'Keep it up!',
              'You\'re doing great!',
              'Keep going!',
              'Awesome!',
              'Nice!',
              'You\'re the best!'
            ];
            const randomMsg = messages[Math.floor(Math.random() * messages.length)];
            showNotification(randomMsg);
            
            // ì‘ì› ì´ë¯¸ì§€(2ì´ˆ)
            updatePetImage('cheer');
            if (cheerTimeout) clearTimeout(cheerTimeout);
            cheerTimeout = setTimeout(() => {
              // ì‘ì› ìƒíƒœ í•´ì œ
              currentPetState = '';
              // ì‘ì› ì´ë¯¸ì§€ê°€ ëë‚œ í›„ ìƒíƒœ ë³µê·€
              if (continuousWorkTime >= 15) {
                updatePetImage('burn');
              } else {
                updatePetImage('basic');
              }
            }, 2000);
          }
        }, 10000); // 10ì´ˆë§ˆë‹¤
      }
    } else {
      continuousWorkTime = 0; // ì‘ì—… ì¤‘ì§€ ì‹œ ë¦¬ì…‹
      petContainer.classList.remove('fire-effect'); 
      updatePetImage('sleep'); // ì‘ì—… ì•ˆ í•  ë•ŒëŠ” sleep
      
      // ì‘ì› ë©”ì‹œì§€ ì¤‘ì§€
      if (encouragementInterval) {
        clearInterval(encouragementInterval);
        encouragementInterval = null;
      }
      if (cheerTimeout) {
        clearTimeout(cheerTimeout);
        cheerTimeout = null;
      }
      
      statusEl.textContent = `Waiting... (${programName || 'Switch to selected program'})`;
      statusEl.classList.remove('active');
    }
  });

  // í”„ë¡œê·¸ë¨ ì„ íƒ ëª¨ë‹¬
  async function openProgramSelector() {
    document.getElementById('programModal').style.display = 'flex';
    const listEl = document.getElementById('programList');
    listEl.innerHTML = '<p>Loading programs...</p>';
    
    availablePrograms = await ipcRenderer.invoke('get-all-programs');
    
    listEl.innerHTML = '';
    
    if (availablePrograms.length === 0) {
      listEl.innerHTML = '<p>No programs found.</p>';
      return;
    }
    
    availablePrograms.forEach(program => {
      const item = document.createElement('div');
      item.className = 'program-item';
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = program;
      checkbox.id = 'prog-' + program;
      checkbox.checked = selectedPrograms.includes(program);
      
      const label = document.createElement('label');
      label.htmlFor = 'prog-' + program;
      label.textContent = program.replace('.exe', '');
      label.style.cursor = 'pointer';
      label.style.flex = '1';
      
      item.appendChild(checkbox);
      item.appendChild(label);
      
      listEl.appendChild(item);
    });
  }

  function closeProgramSelector() {
    document.getElementById('programModal').style.display = 'none';
  }

  function saveSelectedPrograms() {
    const checkboxes = document.querySelectorAll('.program-item input[type="checkbox"]:checked');
    selectedPrograms = Array.from(checkboxes).map(cb => cb.value);
    
    if (selectedPrograms.length === 0) {
      showNotification('Please select at least one program!');
      return;
    }
    
    ipcRenderer.send('set-selected-programs', selectedPrograms);
    updateSelectedProgramsDisplay();
    
    closeProgramSelector();
    showNotification(`${selectedPrograms.length} program(s) selected!`);
    
    // í”„ë¡œê·¸ë¨ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§ ì‹œì‘
    if (!isMonitoring) {
      isMonitoring = true;
      ipcRenderer.send('start-monitoring');
      showNotification('Monitoring started automatically!');
    }
  }

  function petClick() {
    const messages = ['Meow', 'Keep working hard!', 'You\'re doing great!'];
    const randomMsg = messages[Math.floor(Math.random() * messages.length)];
    showNotification(randomMsg);
    
    // í´ë¦­ ì´ë¯¸ì§€ í‘œì‹œ (1ì´ˆê°„)
    updatePetImage('click');
    if (clickTimeout) clearTimeout(clickTimeout);
    clickTimeout = setTimeout(() => {
      // ì›ë˜ ìƒíƒœë¡œ ë³µê·€
      if (isCurrentlyActive) {
        if (continuousWorkTime >= 15) {
          updatePetImage('burn');
        } else {
          updatePetImage('basic');
        }
      } else {
        updatePetImage('sleep');
      }
    }, 1000);
    
    const pet = document.getElementById('pet');
    pet.style.transform = 'scale(1.2) rotate(5deg)';
    setTimeout(() => {
      pet.style.transform = 'scale(1)';
    }, 200);
  }

  document.getElementById('programModal').addEventListener('click', (e) => {
    if (e.target.id === 'programModal') {
      closeProgramSelector();
    }
  });

  // ì´ˆê¸°í™”
  updateTimer();
  updateSelectedProgramsDisplay();
  // ê²½í—˜ì¹˜ ê²Œì´ì§€ ì´ˆê¸°ê°’ì„ 0%ë¡œ
  document.getElementById('expBar').style.width = '0%';
</script>
</body>
</html>